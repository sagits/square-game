<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<script src="phonegap.js"></script>
		<link rel="stylesheet" href="css/jquery-ui.css" />
		<script src="js/jquery-1.9.1.js"></script>
		<script src="js/jquery-ui.js"></script>
		<link href="css/style.css" rel="stylesheet" media="screen">

		<title>Square game</title>
		<script type="text/javascript" charset="utf-8">
			/*	    var images = new Array();
			 document.addEventListener("deviceready", onDeviceReady, false);

			 function onDeviceReady() {
			 window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, gotFS, fail);
			 }

			 function gotFS(fileSystem) {
			 fileSystem.root.getDirectory("imagem", {create: true, exclusive: false}, gotDir, gotFail);
			 }

			 function gotDir(dirEntry) {
			 alert("dir entry");
			 var directoryReader = dirEntry.createReader();

			 directoryReader.readEntries(lerTudo,failAgain);
			 }

			 function lerTudo(entries) {
			 alert("leu entries");
			 var i;
			 for (i=0; i<entries.length; i++) {
			 images.push(entries[i].fullPath);
			 }
			 alert(images.length);
			 preloadImage();
			 firstImage(randomFromInterval(0, 7));
			 }

			 function fail() {
			 alert("erro");
			 }

			 function failAgain() {
			 alert("erro");
			 }
			 function gotFail() {
			 alert("erro no dir");
			 } /*
			 */

var lastrandom;
var oneSrc;
var allSrc;
var animateTime = 500;
var x = 5;
var score = 0;
var count = 10000;
var pointClick = 600;
var scoreClick = 300;
var lastImage;
var jackk = "aaas";
var images = new Array();

			$(document).ready(function() {
	
				document.addEventListener("deviceready", onDeviceReady, false);

				function onDeviceReady() {
					window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, gotFS, fail);
				}

				function gotFS(fileSystem) {
					fileSystem.root.getDirectory("imagem", {
						create : true,
						exclusive : false
					}, gotDir, gotFail);
				}

				function gotDir(dirEntry) {
					alert("dir entry");
					var directoryReader = dirEntry.createReader();

					directoryReader.readEntries(lerTudo, failAgain);
				}

				function lerTudo(entries) {
					alert("leu entries");
					var i;
					for ( i = 0; i < entries.length; i++) {
						images.push(entries[i].fullPath);
					}
					alert(images.length);
					preloadImage();
					firstImage(randomFromInterval(0, 7));
				}

				function fail() {
					alert("erro");
				}

				function failAgain() {
					alert("erro");
				}

				function gotFail() {
					alert("erro no dir");
				}


				document.addEventListener("backbutton", function() {
					navigator.notification.confirm('Do you want to quit', onConfirmQuit, 'Exit', 'Cancel');
				}, true);

				function onConfirmQuit(button) {
					if (button == "1") {
						navigator.app.exitApp();
					}
				}

				// PhoneGap is ready

				function preloadImage() {
					$(images).each(function() {
						$('<img/>')[0].src = this;
						// Alternatively you could use:
						// (new Image()).src = this;
					});
				}

				// Usage:

				//preloadImage();

				var counter = setInterval(meutempo, 1);
				//1000 will  run it every 1 second

				function meutempo() {
					count = count - x;
					if (count <= 0) {
						clearInterval(counter);
						$("#timer").text(0 + "sec");
						gameover = '<div id="gameover"><h3>Game Over</h3></div>';
						//$("body").append(gameover);
						navigator.notification.confirm('Game over! Play again?', function(button) {
							if (button == 1) {
								window.location.href = "level3.html";
							} else {
								window.location.href = "index.html";
							}
						}, 'Game over', 'Play again,menu');
						return;
					}
					if ($("#score").text().indexOf('10000') > -1) {
						clearInterval(counter);
						navigator.notification.confirm('Congratulations! Do you wanna play the next level?', function(button) {
							if (button == 2) {
								window.location.href = "level4.html";
							} else {
								window.location.href = "index.html";
							}
						}, 'Congratulations', 'Menu,Play next level');

					}

					$("#timer").text("Time: " + count + "sec");
				}

				//firstImage(randomFromInterval(0, 7));

				function randomFromInterval(from, to) {
					random = Math.floor(Math.random() * (to - from + 1) + from);
					while (random == lastrandom) {
						random = Math.floor(Math.random() * (to - from + 1) + from);
					}
					lastrandom = random;
					return random;
				}

				function createImage() {
					random = randomFromInterval(0, 1);
					/*	if (random == 1) {
					 imageSrc = 'img/level3/1.jpg';
					 } else if (random == 2) {
					 imageSrc = 'img/level3/2.jpg';
					 } else if (random == 3) {
					 imageSrc = 'img/level3/3.jpg';
					 } */

					return images[+random];
				}

				function firstImage(squareNum) {
                    alert("first image");
					allSrc = createImage();
					oneSrc = createImage();
					while (allSrc == oneSrc) {
						allSrc = createImage();
					}

					$('.square').each(function(i, obj) {

						if (i == squareNum) {
							$(this).attr("src", oneSrc);
						} else {
							$(this).attr("src", allSrc);
						}
					});

				}

				function changeImage() {

					myRandom = randomFromInterval(0, 7);
					lastImage = allSrc;
					allSrc = oneSrc;
					oneSrc = createImage();

					while (allSrc == oneSrc || oneSrc == lastImage) {
						oneSrc = createImage();
					}
					$(".square").each(function() {
						if ($(this).attr('id') == myRandom) {
							$(this).animate({
								opacity : 0.5
							}, '800', function() {
								$(this).attr('src', oneSrc);
								$(this).animate({
									opacity : 1
								}, '800');
								//$(this).fadeIn('fast');
							});

						} else {
							$(this).animate({
								opacity : 0.5
							}, '400', function() {
								$(this).attr('src', allSrc);
								$(this).animate({
									opacity : 1
								}, '400');
								//$(this).fadeIn('fast');
							});
						}
					})
				}

				function changeScoreTime() {
					alert("changing score");
					count += pointClick;
					score += scoreClick;
					$("#score").text("Score: " + score);
				}


				$(".square").click(function() {
					thisSrc = $(this).attr('src');

					if (thisSrc == oneSrc) {
						alert("the right square");
						changeScoreTime();
						changeImage();
						animateTime = animateTime - 30;
					} else {
						$(this).effect('explode');
						$(this).fadeIn();
						changeImage();
						animateTime = animateTime - 30;
						count = count - 1000;
					}

				});

				$(document).on("click", "#gameover", function() {

					location.reload();
				});

			});

		</script>

	</head>
	<body>
		<!--	<div data-theme="a" data-role="header">
		<a href="#menu" data-role="button" data-theme="c" data-rel="back" data-inline="true" data-icon="bars"> Menu </a>
		<h3> Level 4 - Bealtifull animal`s </h3>
		</div> -->
		<div id="page">
			<div id="text">
				<span id="timer"></span>
				<span id="score">Score: 0</span>
			</div>
			<div id="square_div">
				<img src="" id="0" class="square" />
				<img src="" id="1" class="square" />
				<img src="" id="2" class="square" />
				<img src="" id="3" class="square" />
				<img src="" id="4" class="square" />
				<img src="" id="5" class="square" />
				<img src="" id="6" class="square" />
				<img src="" id="7" class="square" />

			</div>

		</div>

	</body>
</html>

